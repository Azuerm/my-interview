{"remainingRequest":"D:\\桌面\\简历\\面试题知识库\\Vue\\admin-system\\node_modules\\babel-loader\\lib\\index.js!D:\\桌面\\简历\\面试题知识库\\Vue\\admin-system\\src\\permission.js","dependencies":[{"path":"D:\\桌面\\简历\\面试题知识库\\Vue\\admin-system\\src\\permission.js","mtime":1747490978255},{"path":"D:\\桌面\\简历\\面试题知识库\\Vue\\admin-system\\babel.config.js","mtime":1747490896596},{"path":"D:\\桌面\\简历\\面试题知识库\\Vue\\admin-system\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1747500624202},{"path":"D:\\桌面\\简历\\面试题知识库\\Vue\\admin-system\\node_modules\\babel-loader\\lib\\index.js","mtime":1747500623976}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:aW1wb3J0IHJvdXRlciBmcm9tICcuL3JvdXRlcic7CmltcG9ydCBzdG9yZSBmcm9tICcuL3N0b3JlJzsKaW1wb3J0IHsgTWVzc2FnZSB9IGZyb20gJ2VsZW1lbnQtdWknOwppbXBvcnQgeyBnZXRUb2tlbiB9IGZyb20gJy4vdXRpbHMvYXV0aCc7CgovLyDnmb3lkI3ljZXot6/nlLEKY29uc3Qgd2hpdGVMaXN0ID0gWycvbG9naW4nXTsKcm91dGVyLmJlZm9yZUVhY2goYXN5bmMgKHRvLCBmcm9tLCBuZXh0KSA9PiB7CiAgLy8g6I635Y+WdG9rZW4KICBjb25zdCBoYXNUb2tlbiA9IGdldFRva2VuKCk7CiAgaWYgKGhhc1Rva2VuKSB7CiAgICBpZiAodG8ucGF0aCA9PT0gJy9sb2dpbicpIHsKICAgICAgLy8g5bey55m75b2V77yM6Lez6L2s5Yiw6aaW6aG1CiAgICAgIG5leHQoewogICAgICAgIHBhdGg6ICcvJwogICAgICB9KTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIOehruWumueUqOaIt+aYr+WQpuW3suiOt+W+l+inkuiJsgogICAgICBjb25zdCBoYXNSb2xlcyA9IHN0b3JlLmdldHRlcnMucm9sZXMgJiYgc3RvcmUuZ2V0dGVycy5yb2xlcy5sZW5ndGggPiAwOwogICAgICBpZiAoaGFzUm9sZXMpIHsKICAgICAgICBuZXh0KCk7CiAgICAgIH0gZWxzZSB7CiAgICAgICAgdHJ5IHsKICAgICAgICAgIC8vIOiOt+WPlueUqOaIt+S/oeaBrwogICAgICAgICAgY29uc3QgewogICAgICAgICAgICByb2xlcwogICAgICAgICAgfSA9IGF3YWl0IHN0b3JlLmRpc3BhdGNoKCd1c2VyL2dldEluZm8nKTsKCiAgICAgICAgICAvLyDmoLnmja7op5LoibLnlJ/miJDlj6/orr/pl67ot6/nlLEKICAgICAgICAgIGNvbnN0IGFjY2Vzc1JvdXRlcyA9IGF3YWl0IHN0b3JlLmRpc3BhdGNoKCdwZXJtaXNzaW9uL2dlbmVyYXRlUm91dGVzJywgcm9sZXMpOwoKICAgICAgICAgIC8vIOWKqOaAgea3u+WKoOWPr+iuv+mXrui3r+eUsQogICAgICAgICAgcm91dGVyLmFkZFJvdXRlcyhhY2Nlc3NSb3V0ZXMpOwoKICAgICAgICAgIC8vIOehruS/nWFkZFJvdXRlc+WujOaIkAogICAgICAgICAgbmV4dCh7CiAgICAgICAgICAgIC4uLnRvLAogICAgICAgICAgICByZXBsYWNlOiB0cnVlCiAgICAgICAgICB9KTsKICAgICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgICAgLy8g56e76ZmkdG9rZW7lubbot7PovaznmbvlvZXpobUKICAgICAgICAgIGF3YWl0IHN0b3JlLmRpc3BhdGNoKCd1c2VyL3Jlc2V0VG9rZW4nKTsKICAgICAgICAgIE1lc3NhZ2UuZXJyb3IoZXJyb3IgfHwgJ+mqjOivgeWksei0pe+8jOivt+mHjeaWsOeZu+W9lScpOwogICAgICAgICAgbmV4dChgL2xvZ2luP3JlZGlyZWN0PSR7dG8ucGF0aH1gKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0KICB9IGVsc2UgewogICAgLy8g5rKh5pyJdG9rZW4KICAgIGlmICh3aGl0ZUxpc3QuaW5kZXhPZih0by5wYXRoKSAhPT0gLTEpIHsKICAgICAgLy8g5Zyo5YWN55m75b2V55m95ZCN5Y2V5Lit77yM55u05o6l6L+b5YWlCiAgICAgIG5leHQoKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vIOWFtuS7luaXoOadg+iuv+mXrueahOmhtemdouWwhumHjeWumuWQkeWIsOeZu+W9lemhtemdogogICAgICBuZXh0KGAvbG9naW4/cmVkaXJlY3Q9JHt0by5wYXRofWApOwogICAgfQogIH0KfSk7"},{"version":3,"names":["router","store","Message","getToken","whiteList","beforeEach","to","from","next","hasToken","path","hasRoles","getters","roles","length","dispatch","accessRoutes","addRoutes","replace","error","indexOf"],"sources":["D:/桌面/简历/面试题知识库/Vue/admin-system/src/permission.js"],"sourcesContent":["import router from './router'\r\nimport store from './store'\r\nimport { Message } from 'element-ui'\r\nimport { getToken } from './utils/auth'\r\n\r\n// 白名单路由\r\nconst whiteList = ['/login']\r\n\r\nrouter.beforeEach(async(to, from, next) => {\r\n  // 获取token\r\n  const hasToken = getToken()\r\n\r\n  if (hasToken) {\r\n    if (to.path === '/login') {\r\n      // 已登录，跳转到首页\r\n      next({ path: '/' })\r\n    } else {\r\n      // 确定用户是否已获得角色\r\n      const hasRoles = store.getters.roles && store.getters.roles.length > 0\r\n      if (hasRoles) {\r\n        next()\r\n      } else {\r\n        try {\r\n          // 获取用户信息\r\n          const { roles } = await store.dispatch('user/getInfo')\r\n\r\n          // 根据角色生成可访问路由\r\n          const accessRoutes = await store.dispatch('permission/generateRoutes', roles)\r\n\r\n          // 动态添加可访问路由\r\n          router.addRoutes(accessRoutes)\r\n\r\n          // 确保addRoutes完成\r\n          next({ ...to, replace: true })\r\n        } catch (error) {\r\n          // 移除token并跳转登录页\r\n          await store.dispatch('user/resetToken')\r\n          Message.error(error || '验证失败，请重新登录')\r\n          next(`/login?redirect=${to.path}`)\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    // 没有token\r\n    if (whiteList.indexOf(to.path) !== -1) {\r\n      // 在免登录白名单中，直接进入\r\n      next()\r\n    } else {\r\n      // 其他无权访问的页面将重定向到登录页面\r\n      next(`/login?redirect=${to.path}`)\r\n    }\r\n  }\r\n})"],"mappings":"AAAA,OAAOA,MAAM,MAAM,UAAU;AAC7B,OAAOC,KAAK,MAAM,SAAS;AAC3B,SAASC,OAAO,QAAQ,YAAY;AACpC,SAASC,QAAQ,QAAQ,cAAc;;AAEvC;AACA,MAAMC,SAAS,GAAG,CAAC,QAAQ,CAAC;AAE5BJ,MAAM,CAACK,UAAU,CAAC,OAAMC,EAAE,EAAEC,IAAI,EAAEC,IAAI,KAAK;EACzC;EACA,MAAMC,QAAQ,GAAGN,QAAQ,CAAC,CAAC;EAE3B,IAAIM,QAAQ,EAAE;IACZ,IAAIH,EAAE,CAACI,IAAI,KAAK,QAAQ,EAAE;MACxB;MACAF,IAAI,CAAC;QAAEE,IAAI,EAAE;MAAI,CAAC,CAAC;IACrB,CAAC,MAAM;MACL;MACA,MAAMC,QAAQ,GAAGV,KAAK,CAACW,OAAO,CAACC,KAAK,IAAIZ,KAAK,CAACW,OAAO,CAACC,KAAK,CAACC,MAAM,GAAG,CAAC;MACtE,IAAIH,QAAQ,EAAE;QACZH,IAAI,CAAC,CAAC;MACR,CAAC,MAAM;QACL,IAAI;UACF;UACA,MAAM;YAAEK;UAAM,CAAC,GAAG,MAAMZ,KAAK,CAACc,QAAQ,CAAC,cAAc,CAAC;;UAEtD;UACA,MAAMC,YAAY,GAAG,MAAMf,KAAK,CAACc,QAAQ,CAAC,2BAA2B,EAAEF,KAAK,CAAC;;UAE7E;UACAb,MAAM,CAACiB,SAAS,CAACD,YAAY,CAAC;;UAE9B;UACAR,IAAI,CAAC;YAAE,GAAGF,EAAE;YAAEY,OAAO,EAAE;UAAK,CAAC,CAAC;QAChC,CAAC,CAAC,OAAOC,KAAK,EAAE;UACd;UACA,MAAMlB,KAAK,CAACc,QAAQ,CAAC,iBAAiB,CAAC;UACvCb,OAAO,CAACiB,KAAK,CAACA,KAAK,IAAI,YAAY,CAAC;UACpCX,IAAI,CAAC,mBAAmBF,EAAE,CAACI,IAAI,EAAE,CAAC;QACpC;MACF;IACF;EACF,CAAC,MAAM;IACL;IACA,IAAIN,SAAS,CAACgB,OAAO,CAACd,EAAE,CAACI,IAAI,CAAC,KAAK,CAAC,CAAC,EAAE;MACrC;MACAF,IAAI,CAAC,CAAC;IACR,CAAC,MAAM;MACL;MACAA,IAAI,CAAC,mBAAmBF,EAAE,CAACI,IAAI,EAAE,CAAC;IACpC;EACF;AACF,CAAC,CAAC","ignoreList":[]}]}